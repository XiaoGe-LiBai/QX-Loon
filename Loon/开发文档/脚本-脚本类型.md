# 脚本类型

http-request
------------------------------------------------------------

在获得一个 http 请求时触发，可配置的参数：

*   `requires-body = true`代表是否获取 http 请求的 body
*   `binary-body-mode = true`代表获取 http 请求的 body 类型为 Uint8Array
*   `argument = "`脚本中可以通过变量`$argument`获取，**为了能够准确解析到参数，请将参数用双引号包裹**

### 配置语法[​](#配置语法 "Direct link to 配置语法")

```
http-request ^https?:\/\/(www.)?(example)\.com script-path=localscript.js,tag = requestScript,requires-body = true,timeout = 10,binary-body-mode = false,argument = "1234",enable=true
```

脚本默认执行超时时间 10s，此类脚本中可以使用如下变量，

*   所有 [Script API](https://nsloon.app/docs/Script/script_api)
*   `$request`: 一个 http 请求信息
    *   `$request.url`: String 类型，请求 URL
    *   `$request.method`: String 类型，请求方法
    *   `$request.headers`: js 对象，请求头
    *   `$request.body`: String 或者 Uint8Array 类型，当`requires-body = true`时才有值，请求的 body
*   `$response`: undefined
*   `$done()`方法参数说明：
    *   `$done()`: 不传任何参数，表示放弃该请求，请求连接会直接断开
    *   `$done({})`: 空 js 对象，请求继续，任何请求参数不会有任何变化
    *   `$done({url:"https://new.example.com/",headers:{},node:"HK"})`: url 参数替换原来的 url，headers 替换原来的 request headers，node 参数表示该请求后续用指定的策略组（也可以是节点名称）进行请求（build 534 版本开始适用）
    *   `$done({response:{ status:200, headers:{}, body:"" }})`: 直接向该请求返回一个假的响应，body 类型可以是 String 或者 Uint8Array，**如果 body 的长度大于 0，会自动计算 headers 中的 content-length，content-encoding 也会根据 body 类型自动生成** **注意** 当 $done() 参数的对象中的 request 不包含 headers 或者 body 时，表示使用原请求的 headers 和 body，如果要清除原请求的 body 时，参数的`body=""`即可，清除原 headers 的话`headers={}`

http-response[​](#http-response "Direct link to http-response")
---------------------------------------------------------------

在获得一个 http 响应时触发，参数`requires-body = true`代表是否获取 http 响应的 body

*   `requires-body = true`代表是否获取 http 请求的 body
*   `binary-body-mode = true`代表获取 http 请求的 body 类型为 Uint8Array
*   `argument = "`脚本中可以通过变量`$argument`获取，**为了能够准确解析到参数，请将参数用双引号包裹**

### 配置语法[​](#配置语法-1 "Direct link to 配置语法")

```
http-response ^https?:\/\/(www.)?(example)\.com script-path=https://example.com/loon.js,timeout=10,requires-body = true,tag = responseScript,enable=true,timeout = 10,binary-body-mode = false,argument = "1234",enable=true
```

脚本默认执行超时时间 10s，此类脚本中可以使用如下变量：

*   所有 [Script API](https://nsloon.app/docs/Script/script_api)
*   `$request`: http 请求信息
    *   `$request.url`: String 类型，请求 URL
    *   `$request.method`: String 类型，请求方法
    *   `$request.headers`: js 对象，请求头
    *   `$request.body`: String 或者 Uint8Array 类型，如果请求带有 body，此参数才有值
*   `$response`: http 响应信息
    *   `$response.status`: 响应状态
    *   `$response.headers`: 响应头
    *   `$response.body`: String 或者 Uint8Array 类型，如果响应带有 body，并且 requires-body = true 时此参数才有值
*   `$done()`方法参数说明：
    *   `$done()`: 不传任何参数，表示放弃该请求，请求连接会直接断开
    *   `$done({})`: 空 js 对象，请求继续，任何请求参数不会有任何变化
    *   `$done({ status:200, headers:{}, body:"" })`: 直接向该请求返回一个假的响应，body 类型可以是 String 或者 Uint8Array，**如果 body 的长度大于 0，会自动计算 headers 中的 content-length，content-encoding 也会根据 body 类型自动生成** **注意** 当 $done() 参数的对象中的 response 不包含 headers 或者 body 时，表示使用原响应的 headers 和 body，如果要清除原请求的 body 时，参数的`body=""`即可，清除原 headers 的话`headers={}`

cron[​](#cron "Direct link to cron")
------------------------------------

*   根据设定的 cron 表达式定时触发脚本
*   "* * * * *" : 分 时 日 月 周
*   "* * * * * *" : 秒 分 时 日 月 周

### 配置语法[​](#配置语法-2 "Direct link to 配置语法")

```
cron "0 8 * * *" script-path=cron.js,tag = cronScript,timeout = 300,argument = "1234",enable=true
```

脚本默认执行超时时间 200s，此类脚本中可以使用如下变量：

*   所有 [Script API](https://nsloon.app/docs/Script/script_api)

network-changed[​](#network-changed "Direct link to network-changed")
---------------------------------------------------------------------

当网络环境发生变化时会调用此类型脚本，如果有多个这种类型的脚本，只会调用配置文件中的第一个

### 配置语法[​](#配置语法-3 "Direct link to 配置语法")

```
network-changed script-path=https://raw.githubusercontent.com/Loon0x00/LoonExampleConfig/master/Script/netChanged.js,tag=changeModel,timeout = 300,argument = "1234",enable=true
```

脚本默认执行超时时间 200s，此类脚本中可以使用如下变量：

*   所有 [Script API](https://nsloon.app/docs/Script/script_api)

generic[​](#generic "Direct link to generic")
---------------------------------------------

以节点、策略组、规则等配置为参数的脚本，需要在 app 内部页面手动进行触发，不会主动触发

### 配置语法[​](#配置语法-4 "Direct link to 配置语法")

```
generic script-path=https://raw.githubusercontent.com/Loon0x00/LoonExampleConfig/master/Script/generic_example.js,tag=GeoLocation,timeout=10,img-url=location.fill.viewfinder.system,timeout = 300,argument = "1234",enable=true
```

此类脚本中可以使用如下变量

*   所有 [Script API](https://nsloon.app/docs/Script/script_api)